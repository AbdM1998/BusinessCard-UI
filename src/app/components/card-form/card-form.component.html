<div class="container d-flex justify-content-center align-items-center mt-5">
  <div class="card shadow-lg p-4" >
    <div class="card-body">
      <h4 class="card-title text-center mb-4">Create Business Card</h4>

      <form [formGroup]="cardForm" (ngSubmit)="onSubmit()">
        <div
          class="mb-4 p-4 border border-secondary border-dashed rounded text-center bg-light"
          (drop)="onFileDrop($event)"
          (dragover)="onDragOver($event)">
          <p class="mb-2 fw-semibold">Drag and drop your XML or CSV file here</p>
          <input type="file" (change)="onFileSelected($event)" accept=".xml,.csv" class="form-control" />
        </div>

        <div class="mb-3">
          <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
          <input id="name" type="text" formControlName="name" class="form-control" placeholder="Enter your name">
          <div class="text-danger small" *ngIf="cardForm.get('name')?.invalid && (cardForm.get('name')?.touched)">
            Name is required
          </div>
        </div>

        <div class="mb-3">
          <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
          <select id="gender" formControlName="gender" class="form-control">
            <option value="">Select Gender</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
          <div class="text-danger small" *ngIf="cardForm.get('gender')?.invalid && (cardForm.get('gender')?.touched)">
            Gender is required
          </div>
        </div>

        <div class="mb-3">
          <label for="dob" class="form-label">Date of Birth <span class="text-danger">*</span></label>
          <input id="dob" type="date" formControlName="dateOfBirth" class="form-control">
          <div class="text-danger small" *ngIf="cardForm.get('dateOfBirth')?.invalid && (cardForm.get('dateOfBirth')?.touched)">
            Date of Birth is required
          </div>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
          <input id="email" type="email" formControlName="email" class="form-control" placeholder="example@email.com">
          <div class="text-danger small" *ngIf="cardForm.get('email')?.invalid && (cardForm.get('email')?.touched)">
            <span *ngIf="cardForm.get('email')?.errors?.['required']">Email is required</span>
            <span *ngIf="cardForm.get('email')?.errors?.['email']">Invalid email address</span>
          </div>
        </div>

        <div class="mb-3">
          <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
          <input id="phone" type="tel" formControlName="phone" class="form-control" placeholder="+962 7X XXX XXXX">
          <div class="text-danger small" *ngIf="cardForm.get('phone')?.invalid && (cardForm.get('phone')?.touched)">
            <span *ngIf="cardForm.get('phone')?.errors?.['required']">Phone is required</span>
            <span *ngIf="cardForm.get('phone')?.errors?.['pattern']">Invalid phone format</span>
          </div>
        </div>

        <div class="mb-3">
          <label for="address" class="form-label">Address</label>
          <textarea id="address" formControlName="address" class="form-control" rows="3" placeholder="Enter your address"></textarea>
        </div>

        <div class="mb-3">
          <label for="photo" class="form-label">Photo (optional, max 1MB)</label>
          <input id="photo" type="file" accept="image/*" class="form-control" (change)="onFileSelected($event)">
          <div class="text-center mt-3">
            <img *ngIf="photoPreview" [src]="photoPreview" class="img-thumbnail shadow-sm" style="max-width: 150px; border-radius: 8px;">
          </div>
        </div>

        <div class="d-flex justify-content-center gap-3 mt-4">
          <button type="submit" class="btn btn-primary px-4" [disabled]="!cardForm.valid">Preview</button>
          <button type="button" class="btn btn-secondary px-4" (click)="resetForm()">Reset</button>
        </div>

      </form>
    </div>
  </div>
</div>

<div *ngIf="showCardPreview" class=" card-preview-overlay">
  <div class="card-preview shadow-lg" style="width: 20rem; border-radius: 1rem;">
    <img *ngIf="previewCard?.photo" class="card-img-top" [src]="previewCard?.photo" alt="Card Image">
    <div class="card-body text-center">
      <p class="card-text">
        <strong>Name:</strong> {{ previewCard?.name }} <br>
        <strong>Gender:</strong> {{ previewCard?.gender }} <br>
        <strong>Date of Birth:</strong> {{ previewCard?.dateOfBirth }} <br>
        <strong>Email:</strong> {{ previewCard?.email }} <br>
        <strong>Phone:</strong> {{ previewCard?.phone }} <br>
        <strong>Address:</strong> {{ previewCard?.address }}
      </p>
      <div class="d-flex justify-content-center gap-2">
        <button class="btn btn-outline-secondary" (click)="closeCardView()">Close</button>
        <button class="btn btn-success" (click)="submit()">Submit</button>
      </div>
    </div>
  </div>
</div>


<div *ngIf="showImportedList" class="card-preview-overlay">
  <div class="shadow-lg p-4 bg-white rounded">
    <h4 class="text-center mb-4">Imported Cards ({{ importedCards.length }})</h4>
    
    <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
      <table class="table table-hover table-bordered">
        <thead class="table-light sticky-top">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Gender</th>
            <th>Date of Birth</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Address</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let card of importedCards; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ card.name }}</td>
            <td>{{ card.gender }}</td>
            <td>{{ card.dateOfBirth }}</td>
            <td>{{ card.email }}</td>
            <td>{{ card.phone }}</td>
            <td>{{ card.address || 'N/A' }}</td>
            <td>
              <button class="btn btn-sm btn-danger" (click)="removeCard(i)">Remove</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-center gap-3 mt-4">
      <button class="btn btn-outline-secondary px-4" (click)="closeImportedList()">Close</button>
      <button class="btn btn-success px-4" (click)="submitAllImportedCards()">Submit All</button>
    </div>
  </div>
</div>

